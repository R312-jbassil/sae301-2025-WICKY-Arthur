---
import Layout from "../layouts/Layout.astro";
import Header from "../components/header.astro";
---

<Layout>
    <Header />
    <div class="flex flex-col items-center">
        <form
            id="registerForm"
            class="w-full max-w-md mx-auto flex flex-col gap-0"
        >
            <h1
                class="text-3xl font-normal mb-3 text-center font-montserrat text-cyan-400"
            >
                CRÉER UN COMPTE
            </h1>
            <div class="flex flex-col gap-2">
                <label class="block mt-6">
                    <span class="text-black text-base font-normal">Prénom</span>
                    <input
                        name="prenom"
                        type="text"
                        required
                        class="block w-full border-b border-gray-400 focus:outline-none focus:border-primary bg-transparent px-0 text-black"
                    />
                </label>
                <label class="block mt-3">
                    <span class="text-black text-base font-normal">Nom</span>
                    <input
                        name="nom"
                        type="text"
                        required
                        class="block w-full border-b border-gray-400 focus:outline-none focus:border-primary bg-transparent px-0 text-black"
                    />
                </label>
                <label class="block mt-3">
                    <span class="text-black text-base font-normal"
                        >Adresse email</span
                    >
                    <input
                        name="email"
                        type="email"
                        required
                        class="block w-full border-b border-gray-400 focus:outline-none focus:border-primary bg-transparent px-0 text-black"
                    />
                </label>
                <label class="block mt-3">
                    <span class="text-black text-base font-normal"
                        >Mot de passe</span
                    >
                    <input
                        name="password"
                        type="password"
                        required
                        class="block w-full border-b border-gray-400 focus:outline-none focus:border-primary bg-transparent px-0 text-black"
                    />
                </label>
                <label class="block mt-3">
                    <span class="text-black text-base font-normal"
                        >Confirmer le mot de passe</span
                    >
                    <input
                        name="confirm_password"
                        type="password"
                        required
                        class="block w-full border-b border-gray-400 focus:outline-none focus:border-primary bg-transparent px-0 text-black"
                    />
                </label>
            </div>
            <button
                type="submit"
                class="mt-8 btn w-full bg-cyan-300 hover:bg-cyan-400 border-0 rounded-none font-montserrat text-white text-base tracking-wide"
                >CRÉER UN COMPTE</button
            >
            <p id="status" class="mt-2 text-center text-red-500"></p>
            <div class="mt-8 text-center text-base">
                Déjà membre ? <a href="/login" class="underline ml-2"
                    >SE CONNECTER</a
                >
            </div>
        </form>
    </div>
</Layout>
<script>
    //@ts-nocheck
    const form = document.getElementById("registerForm");
    const status = document.getElementById("status");
    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const data = {
            prenom: formData.get("prenom"),
            nom: formData.get("nom"),
            email: formData.get("email"),
            password: formData.get("password"),
            passwordConfirm: formData.get("password"), // si tu utilises la validation côté PB
        };
        const res = await fetch("/api/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
        });
        if (res.ok) {
            status.textContent =
                "✅ Compte créé ! Vérifiez votre email pour valider votre compte.";
            status.classList.remove("text-red-500");
            status.classList.add("text-green-600");
            form.reset();
            setTimeout(() => {
                window.location.href = "/login";
            }, 1300);
        } else {
            const error = await res.json();
            status.textContent =
                error?.message || "Erreur, veuillez réessayer.";
            status.classList.remove("text-green-600");
            status.classList.add("text-red-500");
        }
    });
</script>
