---
import FiltreLunettes from "../../components/filtre.astro";
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/header.astro";
import Card from "../../components/card.astro";
import pb from "../../../utils/pb.ts";

const url = new URL(Astro.url);
const typeFiltre = url.searchParams.get("filtre") ?? "toutes";

let records = [];

if (typeFiltre === "toutes") {
    // Récupère toutes les lunettes des deux collections
    const modelesBase = await pb.collection("modeles").getFullList();
    const modelesIA = await pb.collection("ModeleIa").getFullList();
    records = [...modelesBase, ...modelesIA];
} else if (typeFiltre === "base") {
    // Uniquement les modèles de base
    records = await pb.collection("modeles").getFullList();
} else if (typeFiltre === "ia") {
    // Uniquement les modèles générés par IA
    records = await pb.collection("ModeleIa").getFullList();
}
---

<Layout>
    <Header />
    <h1 class="text-3xl p-8 pb-4">Nos Modèles de Lunettes</h1>
    <div class="pb-16"><FiltreLunettes actif={typeFiltre} /></div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 px-8">
        {
            records.map((record) => (
                <Card
                    id={record.id}
                    nom={record.nom}
                    prix={record.prix || 0}
                    ancien_prix={record.ancien_prix || 0}
                    fabrication_fr={record.fabrication_fr || "non"}
                    code_svg={record.code_svg}
                />
            ))
        }
    </div>
</Layout>
